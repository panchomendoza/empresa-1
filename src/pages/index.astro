---
import { useStoryblokApi } from '@storyblok/astro';
import StoryblokComponent from '@storyblok/astro/StoryblokComponent.astro';
import MainLayout from '../layouts/MainLayout.astro';

// Identificar la empresa actual desde las variables de entorno
const currentTenantFolder = import.meta.env.PUBLIC_SITE_FOLDER || 'empresa-1';
const storyblokApi = useStoryblokApi();

// 1. Obtener la p치gina Home de la empresa actual
const { data } = await storyblokApi.get(`cdn/stories/${currentTenantFolder}/home`, {
  version: 'draft',
}) as any;
const story = data.story;

// 2. Obtener la Configuraci칩n Global de la empresa actual
let globalConfig;
try {
    const { data: configResponse } = await storyblokApi.get(`cdn/stories/${currentTenantFolder}/settings`, {
        version: 'draft',
    }) as any;
    globalConfig = configResponse.story;
} catch (error) {
    console.error(`No se encontr칩 configuraci칩n para: ${currentTenantFolder}`, error);
}

---

<MainLayout 
    title={story.content.seo?.title || story.name} 
    description={story.content.seo?.description}
    config={globalConfig}
>
    <StoryblokComponent blok={story.content} />
</MainLayout>