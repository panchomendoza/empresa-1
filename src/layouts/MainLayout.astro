---
import '../styles/global.css';
import SEO from '../components/SEO.astro';
import Header from '../components/Header.astro';
import Footer from '../components/Footer.astro';

const { title, description, image, config } = Astro.props;

// 1. Extracción de datos de Branding desde el contenido de Storyblok
const branding = config?.content;

const primary = branding?.color_primary || '#000000';
const secondary = branding?.color_secondary || '#cccccc';
const backgroundColor = branding?.background_color || '#f8fafc'; // Fallback a slate-50
const favicon = branding?.favicon?.filename || 'favicon.svg';

// Manejo de Border Radius (Asumiendo que guardas un número o un string como '8px')
const borderRadius = branding?.border_radius 
    ? (typeof branding.border_radius === 'number' ? `${branding.border_radius}px` : branding.border_radius)
    : '4px';

// Assets y navegación
const logo = branding?.logo?.filename || '';
const menuItems = branding?.menu_items || [];
const socialLinks = branding?.social_links || [];
const copyrightText = branding?.copyright_text || "";
---

<html lang="es">
    <head>        
        <SEO 
            title={title} 
            description={description} 
            image={image}
            favicon={favicon}
        />

        <script is:inline>
            const theme = (() => {
                if (typeof localStorage !== 'undefined' && localStorage.getItem('theme')) {
                return localStorage.getItem('theme');
                }
                return window.matchMedia('(prefers-color-scheme: dark)').matches ? 'dark' : 'light';
            })();

            if (theme === 'dark') {
                document.documentElement.classList.add('dark');
            } else {
                document.documentElement.classList.remove('dark');
            }
        </script>

        <style is:global define:vars={{ primary, secondary, backgroundColor, borderRadius }}>
            :root {
                --brand-primary: var(--primary);
                --brand-secondary: var(--secondary);
                --brand-bg: var(--backgroundColor);
                --brand-radius: var(--borderRadius);
            }

            /* Configuración para Dark Mode manual si no usas variables de Storyblok para todo */
            :root.dark {
                --brand-bg: #0f172a; /* Ejemplo de color oscuro por defecto */
                /* Aquí podrías sobreescribir las variables de Storyblok si el usuario 
                   no definió colores específicos para modo oscuro */
            }

            body {
                background-color: var(--brand-bg);
                transition: background-color 0.3s ease, color 0.3s ease;
            }
        </style>
    </head>
    <body class="min-h-screen flex flex-col">
        <Header data={{ logo, menuItems }} />
        
        <main class="flex-grow">
            <slot />
        </main>

        <Footer data={{ logo, socialLinks, copyrightText }} />
    </body>
</html>